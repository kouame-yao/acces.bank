<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Espace Client - Compte Bancaire</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="stylesheet" href="css/solde.css" />
    <script
      type="module"
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"
    ></script>
  </head>
  <body>
    <div class="container">
      <!-- Header with Logout Button -->
      <div class="header">
        <h4>Bienvenue, <span id="userName">MARIE JEANNETTE</span></h4>
        <button class="logout" onclick="logout()">Déconnexion</button>
      </div>

      <!-- Account Information -->
      <div class="account-info">
        <div class="balance">
          <h2>Solde du compte</h2>
          <h3>Solde actuel: <span id="solde" style="color: red"></span></h3>
          <p>
            Statut du compte:
            <span style="color: limegreen">Votre compte est actif</span>
          </p>
          <p><ion-icon name="location-sharp"></ion-icon>Zurich - Suisse</p>
          <p>Dernière connexion: <span id="date"></span></p>
        </div>
        <div class="details">
          <h3>Informations du Compte</h3>
          <p><strong>Nom :</strong> MARIE JEANNETTE</p>
          <p><strong>Numéro de Compte :</strong> 1067058123456</p>
          <p><strong>IBAN :</strong> CH93 0076 2011 6238 5295 7</p>
          <p><strong>Code BIC :</strong> UBSWCHZH80A</p>
        </div>
      </div>

      <!-- Recent Transactions -->
      <div class="transactions">
        <h2>Transactions Récentes</h2>
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Description</th>
              <th>Montant</th>
              <th>Type</th>
            </tr>
          </thead>
          <tbody id="transactions-body">
            <!-- Les transactions seront ajoutées ici dynamiquement -->
          </tbody>
        </table>
      </div>
    </div>
    <div class="navbar">
      <a href="#" class="nav-item"> <i class="fas fa-wallet"></i> Solde </a>
      <a href="historique.html" class="nav-item">
        <i class="fas fa-history"></i> Historique
      </a>
      <a href="virement.html" class="nav-item">
        <i class="fas fa-exchange-alt"></i> Virement
      </a>
      <a href="rib.html" class="nav-item">
        <i class="fas fa-file-invoice"></i> Rib
      </a>
    </div>

    <script>
      function elements(post) {
        const tbody = document.getElementById("transactions-body");
        const tr = document.createElement("tr");

        // Création des colonnes
        const tdDate = document.createElement("td");
        tdDate.textContent = `03/07/2025`;

        const tdDescription = document.createElement("td");
        tdDescription.textContent = post.libelle;

        const tdMontant = document.createElement("td");
        tdMontant.textContent = `- ${post.montant}`;
        tdMontant.style.color = post.type === "Crédit" ? "green" : "red"; // Couleur selon type

        const tdType = document.createElement("td");
        tdType.textContent = post.type;

        // Ajout des colonnes à la ligne
        tr.appendChild(tdDate);
        tr.appendChild(tdDescription);
        tr.appendChild(tdMontant);
        tr.appendChild(tdType);

        // Ajout de la ligne au tableau
        tbody.appendChild(tr);
      }

      async function getVirement() {
        const response = await fetch(
          "https://acces-bank.onrender.com/totalvirements",
          {
            method: "GET",
            headers: {
              Accept: "application/json",
              "Content-Type": "application/json",
            },
          }
        );

        const data = await response.json();
        console.log(data);
        const docs = data.table;
        for (let doc of docs) {
          console.log(doc);
          elements(doc);
        }
      }

      function Solde() {
        const r = fetch("https://acces-bank.onrender.com/montant")
          .then((response) => {
            return response.json();
          })
          .then((docs) => {
            const SoldeFormat = docs.solde;

            const dataFormat = new Intl.NumberFormat("de-CH", {
              style: "currency",
              currency: "CHF",
            }).format(SoldeFormat);
            document.querySelector("#solde").innerHTML = dataFormat;
          });
      }

      document.addEventListener("DOMContentLoaded", () => {
        Solde();
        getVirement();
      });
      function logout(params) {
        location.href = "index.html";
      }
      const horloge = new Date();
      const dataHorloge = horloge.toLocaleDateString();
      document.getElementById("date").innerHTML = dataHorloge;
    </script>
  </body>
</html>
